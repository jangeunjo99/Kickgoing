# YOLOv5 기반 효과적인 전기 자전거 인식 방법  

<br/>
<br/>
<br/>

## 목차
0. 프로젝트 성과
1. 담당 업무 및 나의 기여도
2. 프로젝트 개요  
   2.1 프로젝트 개요  
   2.2 프로젝트 소개  
3. 제안 시스템  
   3.1 사용자 입력 파일  
   3.2 제안 시스템 흐름도  
4. 실험  
   4.1 실험 환경  
   4.2 실험 데이터  
   4.3 파라미터 최적화  
   4.4 실험 결과
   
   
<br/>
<br/>
<br/>

# 0. 프로젝트 성과 
1. <code style="color : red">**[KSC2022]** YOLOv5 기반 효과적인 전기 자전거 인식 방법 </code>

<br/>
<br/>
<br/>

# 1. 담당 업무 및 나의 기여도 
0. 나의 기여도 : **60%**
1. 학습 데이터 구축  
   - roboflow 플랫폼을 사용하여 학습/검증 데이터 구축
   - roboflow : 컴퓨터 비전 모델을 훈련하는 과정을 간소화하기 위해 설계된 플랫폼
2. YOLOv5를 통한 훈련 데이터 학습
3. 인식 정확도 한계를 극복하기 위한 아이디어 제안
   - 전기 자전거의 전체 뿐만 아니라 바(bar), 안장과 뒷바퀴로 이루어진 뒷부분(back part)을 추가로 탐지하는 기법
   - 어두운 사진의 밝기와 명암비를 조절하여 학습     


<br/>
<br/>
<br/>

# 2. 프로젝트 개요
## 2.1 프로젝트 개요

|||
|:---:|--|
|**과제명**|YOLOv5 기반 효과적인 전기 자전거 인식 방법|
|**지원 기관**|(주)올룰로 Kickgoing|
|**프로젝트 기간**| 2022.06 - 2022.11 |
|**연구 목표**| 기존 방법(YOLOv5를 통한 자전거 전체만을 학습) 대비 인식 정확도 높은 모델 제안 |

<br/>
<br/>
<br/>

## 2.2 프로젝트 소개

- 킥고잉(Kickgoing)은 (주)올룰로에서 제공하는 국내 최초 전동 킥보드 공유 서비스이다.
- 킥고잉의 전기 자전거 서비스는 사용자가 원하는 서비스 지역 내 어디에서나 자유롭게 반납할 수 있으며, 앱을 통해 주변의 전기 자전거 위치를 확인할 수 있다.  
- 전기 자전거 위치는 GPS를 통해 추적되지만, GPS 오차로 인해 위치 정보의 정확도가 떨어질 수 있는 단점이 있다.  
- 킥고잉은 이러한 GPS의 한계를 극복하기 위해 사용자가 반납할 때 촬영한 사진을 GPS 정보와 함께 제공하고 있다.  
- 하지만, 일부 사용자가 전기 자전거가 없는 사진을 올리거나 구별하기 어려운 사진을 촬영하는 경우가 있다.  
- **따라서, 반납 사진 중 실제 전기 자전거가 존재하는 사진들만 제공하는 것은 매우 중요하다.**

<br/>
<br/>
<br/>

# 3. 제안 시스템  
### 전기 자전거 부분 탐지 기법   
- 사용자가 촬용한 이미지에서 자전거의 일부만 포착되는 경우가 일반적이다.  
- 이로 인해 전체 자전거를 대상으로 하는 인식 방식만으로는 정확도에 제한이 있다.   
- 이를 해결하기 위해, 전기 자전거의 특정 부분을 식별할 수 있는 **부분 탐지 기법**을 개발하고자 한다.

**▶ 자전거의 일부만 나타나는 이미지에서도 전기 자전거를 효과적으로 인식할 수 있다.◀**  
 
 <br/>
 
 ### 사진의 밝기 및 명암비 조절 기법   
- 밤이나 어두운 환경에서 촬영된 사진은 빛의 부족으로 인식 성능이 저하될 수 있다.
- 이를 해결하기 위해, 이미지의 밝기 및 명암비 조절 기법을 적용하고자 한다.

**▶ 사진의 밝기와 명암비를 자동으로 조정하여 어두운 사진에서도 전기 자전거를 효과적으로 인식할 수 있다.◀**  


  
<br/>
<br/>

## 3.1  전기 자전거 부분 탐지 기법 

<br/>

<img src="/1. Image/labeling_ex.png" title="부분 라벨링의 예"></img><br/>

- 전기 자전거의 특징을 잘 나타낼 수 있는 부분을 탐지하기 위해 먼저 7개의 부분으로 세분화하여 학습을 진행 **[그림1 왼쪽]**  
- 핸들, 바, 안장, 앞바퀴, 뒷바퀴, 앞바퀴와 뒷바퀴를 포함한 바퀴 전체, 안장과 뒷바퀴를 포함한 뒷부분으로 라벨(Label) 후보 설정  

  
- 7개 부분에 대한 모델의 성능 척도로는 mAP(mean Average Precision), 정확도(precision), 재현율(recall) 사용
<br/>

### ⚒️ 7개 부분의 성능 평가 결과 ⚒️

||precision(%)|recall(%)|mAP@.75(%)|mAP@.85(%)|mAP@.95(%)|
|:---:|:---:|:---:|:---:|:---:|:---:|  
|handle|69.4|66.3|62.7|51.5|60|  
|**bar**|81.5|74.4|73.1|79.9|61.9|  
|saddle|86.0|84.1|86.3|73.8|71.5|  
|front wheel|87.6|89.3|88.2|76.9|73.0|  
|back wheel|92.0|87.1|87.6|81.4|75.6|
|**back part**|93.3|89.2|91.3|85.2|79.6|
|wheels|91.8|83.8|87.3|82.1|79.6|    

- 뒷부분, 바퀴 전체와 뒷바퀴, 앞바퀴, 안장, 바, 핸들 순으로 잘 인식하는 것을 확인  
<br/>

### ⚒️ 최종 라벨 선정 ⚒️
**[그림1 오른쪽] 참고**
<br/>
 
|최종 선택|이유|  
|:---:|:---:|
|**back part**|인식 성능이 가장 좋음|  
|**bar**|비교적 인식 성능은 낮지만, 킥고잉 전기 자전거의 특유의 색이 잘 나타나기 때문에 라벨로 선정|
 

  
<br/>
<br/>
<br/>

## 3.2 사진의 밝기 및 명암비 조절 기법  

<br/>

<img src="/1. Image/labeling_ex3.png" title="밝기 및 명암비 조절의 예"></img><br/>

- 분류가 제대로 이루어지지 않은 사진들을 직접 검토해본 결과, 어두운 조명으로 인해 전기 자전거가 올바르게 인식되지 않는 경우가 있음을 확인  
- 특히, 사용자가 밤 시간대에 전기 자전거를 사용한 후 촬영한 사진에서 이 문제가 두드러졌으며, 이러한 상황은 사진이 너무 어두워 전기 자전거를 명확하게 식별하기 어려울 수 있음. **[그림2 왼쪽]**

<br/>

### ✨ 사진의 밝기 조절 ✨ 

- 사진의 밝기 조절을 위해 모든 픽셀에 일정 값을 더하거나 빼서 사진을 더욱 밝거나 어둡게 변경 시킴.
- &src&는 입력 사진, $dst$는 밝기 변경 후의 출력 사진, $n$은 조절할 밝기 값 의미
- 제안 방법은 어두운 사진의 밝기를 높이기 위해 모든 픽셀에 양수 값을 더하여 사진의 전체적인 밝기를 높임  

<div align="center"> <p> $dst(x,y) = saturate(src(x,y) + n)$ </p> </div>   

<br/>

### ✨ 사진의 명암 조절 ✨

- 명암비는 영상 및 사진에서 밝은 영역과 어두운 영역 사이에 드러나는 밝기 차이의 강도를 의미
- 제안 방법은 사진의 어두운 픽셀은 더욱 어둡게, 밝은 픽셀은 더욱 밝게 변경하여 명암비를 증가시킴.
- 그레이스케일의 중간값인 128을 기준으로 설정하여 픽셀이 128보다 크면 더욱 밝게, 128보다 작으면 더욱 어둡게 변경  

<div align="center"> <p> $dst(x,y) = saturate(src(x,y) +(src(x,y)-128)• \alpha )$ </p> </div>   


<br/>
<br/>
<br/>

# 4. 성능 평가   
**제안 기법이 기존의 방법(YOLOv5를 통한 자전거 전체만을 학습)보다 전기 자전거를 얼마나 더 잘 인식하는지 평가**

<br/>

## 4.1 실험 데이터 및 평가 지표  
- 실험 데이터 : (주)울롤로에서 제공받은 4,791장의 킥고잉 서비스 전기 자전거 반납 사진 사용
- 훈련 데이터:검증 데이터:테스트 데이터 = 7:2:1
- 평가 지표 : mAP(mean Average Precision), 정확도(precision), 재현율(recall) 사용  
 
<br/>


## 4.2 실험 결과 

<br/>

### 🥇 제안 기법1. 부분 라벨링 성능 평가 결과 🥇  
<br/>

||precision(%)|recall(%)|mAP@.75(%)|mAP@.85(%)|mAP@.95(%)|
|:---:|:---:|:---:|:---:|:---:|:---:|  
|기존 방법|93.1|75.9|80.9|65.6|52.6|
|제안 방법1|94.2|78.4|81.2|71.9|58.6|  
- 부분 라벨링 방법(제안 방법1)과 전기 자전거를 세분화하지 않고 전체를 라벨링하여 훈련시킨 기존 방법의 성능 평가 결과
- 제안 방법은 기존 방법에 비해 정확도, 재현율, mAP 모든 척도에서 더 좋은 성능을 보임을 확인
 
**▶바와 뒷부분을 추가로 학습시킴으로써 전기 자전거를 인식하지 못한 경우를 보완하여 더욱 정확히 전기 자전거를 인식◀** 

<br/>

### 🥈 제안 기법2. 밝기 및 명암비 조절 후 성능 평가 결과 🥈 
<br/>

||precision(%)|recall(%)|mAP@.75(%)|mAP@.85(%)|mAP@.95(%)|
|:---:|:---:|:---:|:---:|:---:|:---:|  
|기존 방법|93.1|75.9|80.9|65.6|52.6|
|제안 방법2|93.2|78.6|84.2|75.9|71.6|  
- 어두운 사진의 밝기와 명암비를 조절한 방법과 어두운 사진을 그대로 훈련시킨 기존 방법의 성능 평가 결과  
- 제안 방법은 기존 방법에 비해 정확도, 재현율, mAP 모든 척도에서 더 좋은 성능을 보임을 확인
 
**▶어두운 사진의 밝기와 명암비를 조절함으로써 어두운 사진에서 인식하지 못한 경우를 보완하여 더욱 정확히 전기 자전거를 인식◀**   

<br/>

### 🏅 통합) 제안 기법1+2. 부분 라벨링 + 밝기 및 명암비 조절 후 성능 평가 결과 🏅 
<br/>

||precision(%)|recall(%)|mAP@.75(%)|mAP@.85(%)|mAP@.95(%)|
|:---:|:---:|:---:|:---:|:---:|:---:|  
|기존 방법|93.1|75.9|80.9|65.6|52.6|
|제안 방법2|94.8|90.4|89.5|81.4|75.9|  
- 부분 라벨링과 밝기 및 명암비를 조절한 방법을 모두 적용한 결과 더욱 효과적임을 확인할 수 있음.
- 특히, 기존에 어두워서 인식하지 못한 사진 속 전기 자전거를 인식할 수 있어 recall 측면에서 높은 향상을 보임을 확인할 수 있다.  
 

<br/>
<br/>
<br/>

