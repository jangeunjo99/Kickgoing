# YOLOv5 기반 효과적인 전기 자전거 인식 방법  

<br/>
<br/>
<br/>

## 목차
0. 프로젝트 성과
1. 담당 업무 및 나의 기여도
2. 프로젝트 개요  
   2.1 프로젝트 개요  
   2.2 프로젝트 소개  
3. 제안 시스템  
   3.1 사용자 입력 파일  
   3.2 제안 시스템 흐름도  
4. 실험  
   4.1 실험 환경  
   4.2 실험 데이터  
   4.3 파라미터 최적화  
   4.4 실험 결과
   
   
<br/>
<br/>
<br/>

# 0. 프로젝트 성과 
1. <code style="color : red">**[KSC2022]** YOLOv5 기반 효과적인 전기 자전거 인식 방법 </code>

<br/>
<br/>
<br/>

# 1. 담당 업무 및 나의 기여도 
0. 나의 기여도 : **60%**
1. 학습 데이터 구축  
   - roboflow 플랫폼을 사용하여 학습/검증 데이터 구축
   - roboflow : 컴퓨터 비전 모델을 훈련하는 과정을 간소화하기 위해 설계된 플랫폼
2. YOLOv5를 통한 훈련 데이터 학습
3. 인식 정확도 한계를 극복하기 위한 아이디어 제안
   - 전기 자전거의 전체 뿐만 아니라 바(bar), 안장과 뒷바퀴로 이루어진 뒷부분(back part)을 추가로 탐지하는 기법
   - 어두운 사진의 밝기와 명암비를 조절하여 학습     


<br/>
<br/>
<br/>

# 2. 프로젝트 개요
## 2.1 프로젝트 개요

|||
|:---:|--|
|**과제명**|YOLOv5 기반 효과적인 전기 자전거 인식 방법|
|**지원 기관**|(주)올룰로 Kickgoing|
|**프로젝트 기간**| 2022.06 - 2022.11 |
|**연구 목표**| 기존 방법(YOLOv5를 통한 자전거 전체만을 학습) 대비 인식 정확도 높은 모델 제안 |

<br/>
<br/>
<br/>

## 2.2 프로젝트 소개

- 킥고잉(Kickgoing)은 (주)올룰로에서 제공하는 국내 최초 전동 킥보드 공유 서비스이다.
- 킥고잉의 전기 자전거 서비스는 사용자가 원하는 서비스 지역 내 어디에서나 자유롭게 반납할 수 있으며, 앱을 통해 주변의 전기 자전거 위치를 확인할 수 있다.  
- 전기 자전거 위치는 GPS를 통해 추적되지만, GPS 오차로 인해 위치 정보의 정확도가 떨어질 수 있는 단점이 있다.  
- 킥고잉은 이러한 GPS의 한계를 극복하기 위해 사용자가 반납할 때 촬영한 사진을 GPS 정보와 함께 제공하고 있다.  
- 하지만, 일부 사용자가 전기 자전거가 없는 사진을 올리거나 구별하기 어려운 사진을 촬영하는 경우가 있다.  
- **따라서, 반납 사진 중 실제 전기 자전거가 존재하는 사진들만 제공하는 것은 매우 중요하다.**

<br/>
<br/>
<br/>

# 3. 제안 시스템
- 사용자가 직접 촬영한 이미지 특성상 자전거의 전체가 나오지 않고 부분만 나온 경우가 많아 단순히 자전거 전체를 인식하는 것은 인식 정확도에 한계가 있다.
  ▶ **전기 자전거 부분 탐지 기법**  
- 밤에 촬영하여 빛이 없는 경우 어두운 사진에서 전기 자전거를 인식하는 것 또한 성능 저하의 원인이 된다.
  ▶ **사진의 밝기 및 명암비 조절 기법**  


## 3.1  전기 자전거 부분 탐지 기법  
- 전기 자전거의 특징을 잘 나타낼 수 있는 부분을 탐지하기 위해 먼저 7개의 부분으로 세분화하여 학습을 진행
- 핸들, 바, 안장, 앞바퀴, 뒷바퀴, 앞바퀴와 뒷바퀴를 퐇마한 바퀴 전체, 안장과 뒷바퀴를 포함한 뒷부분으로 라벨(Label) 설정  
<img src="/1. Image/labeling_ex1.png" title="부분 라벨링의 예"></img><br/>
- 7개 부분에 대한 모델의 성능 척도로는 mAP(mean Average Precision), 정확도(precision), 재현율(recall) 사용
<img src="/1. Image/result_1.png" title="7개 부분의 성능평가 결과"></img><br/>
- 뒷부분, 바퀴 전체와 뒷바퀴, 앞바퀴, 안장, 바, 핸들 순으로 잘 인식하는 것을 확인
- 따라서, 성능이 가장 좋은 뒷부분과 킥고잉 전기 자전거의 특유의 색이 잘 나타나면서도 뒷부분과 겹치지 않는 바를 추가로 학습시킬 부분으로 선정 (아래 사진)
<img src="/1. Image/labeling_ex2.png" title="부분 라벨링의 예"></img><br/>

  
<br/>
<br/>
<br/>

## 3.2 사진의 밝기 및 명암비 조절 기법  
- 분류가 제대로 이루어지지 않은 사진들을 직접 검토해본 결과, 어두운 조명으로 인해 전기 자전거가 올바르게 인식되지 않는 경우가 있음을 확인  
- 특히, 사용자가 밤 시간대에 전기 자전거를 사용한 후 촬영한 사진에서 이 문제가 두드러졌으며, 이러한 상황은 사진이 너무 어두워 전기 자전거를 명확하게 식별하기 어려울 수 있음. (그림 왼쪽)
<img src="/1. Image/labeling_ex3.png" title="밝기 및 명암비 조절의 예"></img><br/>

<img src="Overview.png" title="프로그램 흐름도"></img><br/>

- **Job1** : 가명화 연산 수행을 위해 통계 정보 획득 단계
  - Map, Combiner, Reduce 함수로 구성
  - 수행 기능 : 상하단 코딩, 부분 총계 [평균, 표준편차] / 난수화 [최솟값, 최댓값]
  - **Map()** : 입력 데이터에서 특정 조건에 맞는 데이터 필터링
  - **Combiner()** : Map의 출력을 합계, 제곱합, 개수, 최솟값, 최댓값 등으로 집계하여 전송
  - **Reduce()** : Combiner의 출력을 통해 열의 평균/표준편차, 최솟값/최댓값 계산
  
- **Job2** : 8가지 가명 처리를 실질적으로 수행하는 작업
  - 불필요한 Reduce 단계를 생략한 Map-Only 작업
  - **Map()** : 레코드 별로 한 줄씩 읽어 가명 처리에 해당하는 열일 경우 연산 수행
  - Map 함수의 결과값은 최종적으로 가명 처리가 완료된 데이터로 HDFS에 저장
 
<br/>
<br/>
<br/>

# 4. 실험

## 4.1 실험 환경  
 
<table>
  <tr>
    <td rowspan="2">노드 수</td>
    <td>네임 노드 : 1대</td>
  </tr>
  <tr>
  <td>데이터 노드 : 15대</td>
  </tr>
  <tr>
    <td rowspan="3">노드 성능</td>
    <td>CPU : Intel(R) Xeon(R) Silver@2.10GHz</td>
  </tr>
  <tr>
    <td>Memory : 64GB</td>
  </tr>
  <tr>
    <td> SSD : 500GB </td>
  </tr>
  <tr>
    <td> 운영체제 </td>
    <td> Linux </td>
  </tr>
  <tr>
    <td> Hadoop </td>
    <td> Hadoop-3.3.5 </td>
  </tr>

</table>

<br/>
<br/>
<br/>

## 4.2 실험 데이터
- (주)이지서티에서 제공한 주민등록번호, 성별, 혈액형, 주거래은행, 근무년수, 연봉 등으로 구성된 가상 개인 정보를 사용
- 수치형 8개, 문자형 22개로 총 30개의 열로 구성된 정형 데이터
- 500GB / 1000GB / 1500GB / 2000GB 대규모 데이터로 실험 진행
- 2000GB 기준 약 60억 행으로 구성  
<img src="Data.png" title="데이터 일부"></img><br/>

<br/>
<br/>
<br/>

## 4.3 파라미터 최적화 
- 하둡은 파라미터에 따라 수행 시간과 속도가 크게 영향 받음
- 최적의 파라미터는 그리드 서치 (Grid Search)방식으로 모니터링과 실험을 거쳐 최적화된 값 확인
  
|매개변수|설명|서치 범위|
|:---:|:---:|:---:|
|dfs.block.size|HDFS에서 파일을 블록으로 나눌 때 각 블록의 크기|{128MB, 256MB, 512MB}|
|mapreduce.job.maps|Map 단계에서 실행할 맵 태스크 개수|{10, 30, 50, 100, 200}|
|mapreduce.job.reduces|Reduce 단계에서 실행할 리듀스 태스크 개수|{10, 30, 50, 100, 200}|
|mapreduce.input.fileinputformat.split.minsize|하나의 입력 파일이 분할 가능한 최소 크기|{128MB, 256MB, 512MB}|
|mapreduce.input.fileinputformat.split.maxsize|하나의 입력 파일이 분할 가능한 최대 크기|{128MB, 256MB, 512MB}|
|mapreduce.reduce.memory.mb|MapReduce 작업의 Reduce 태스크가 사용할 수 있는 메모리 양|{2GB, 4GB, 8GB, 16GB}|
|mapreduce.map.memory.mb|MapReduce 작업의 Map 태스크가 사용할 수 있는 메모리 양|{2GB, 4GB, 8GB, 16GB}|
|mapred.compress.map.output|Map 단계 출력의 압축 여부|{True}|
|mapred.output.compression.type|출력 데이터의 압축 유형 결정|{BLOCK}|
|mapred.map.output.compression.codec|맵 작업의 출력 데이터에 사용할 압축 코덱|{Snappy}|

<br/>
<br/>
<br/>

## 4.4 실험 결과
<img src="Result.png" title="데이터 일부"></img><br/>

- 본 연구는 정보화 시대의 데이터 활용성을 위한 **대용량 데이터에 대한 맵리듀스 기반 가명 처리 시스템**을 제안한다.
- 총 8개의 대표적인 가명 처리 기능 동시 수행으로 실험
- HDFS에 있는 데이터를 읽어 분할하고 Job1과 Job2를 거쳐 가명 처리를 수행하여 저장하는 데 2TB 데이터 기준 61.83분이 소요됨을 확인
- 제안하는 시스템이 실제 산업에서도 대규모 정형 데이터 가명 처리에 실용적으로 적용할 수 있음을 보여준다.

<br/>
<br/>
<br/>



